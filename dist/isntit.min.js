/*!
 * Isntit - a simple javascript validation library
 * version: 1.0.0
 * (c) 2016-2017 stoempsaucisse
 * Released under the MIT License.
 */

!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):e.Isntit=r()}(this,function(){"use strict";function e(){}function r(e,r){return Object.prototype.hasOwnProperty.call(e,r)}function t(e){return null!==e&&"object"==typeof e}function n(e,r){return e.replace(/\%\{([\w\d_\.]+)\}/g,function(t,n){return"undefined"!=typeof r[n]?r[n]:(h("There is no replacement for "+t+" in "+e,r),t)})}function s(e){return e.charAt(0).toUpperCase()+e.slice(1)}function a(e,r){return this instanceof a?(r&&r.config&&(Object.assign(f,r.config),delete r.config),Object.assign(this.options,r||{}),this.cache={checkersToStep:{},messages:{}},this.checkRules(e),this.rules=e||{},void(this.errors={})):(h('Isntit([rules [, options]]) is a constructor and should be called with the "new" keyword.'),new a(e,r))}function o(e,t,n,s){var a=this;r(a.errors,t)||(a.errors[t]={}),s?(r(a.errors[t],n)||(a.errors[t][n]={}),a.errors[t][n][s]=!0):a.errors[t][n]=!0}function i(e,r,t){var n=this;if("function"==typeof e.validate)e.validate.call(n,r,t)||o.call(n,t,t.fieldName,t.ruleName);else for(var s in t.ruleSet[t.ruleName])e.validate[s].call(n,r,t)||o.call(n,t,t.fieldName,t.ruleName,s)}function l(e,r){var n=this,s=e.ruleName+(r?"::"+r:"");if(!n.cache.messages[s]){var a;a=e.ruleSet[e.ruleName].message||f.messages[e.ruleName]||f.messages.notValid,t(a)&&(a=a[r]||f.messages.notValid),n.cache.messages[s]="function"==typeof a?a(e,r):a}return n.cache.messages[s]}function u(e,r,t){var a=this,o=[];for(var i in a.errors[e])if(a.errors[e][i]===!0)o.push(l.call(a,t));else for(var u in a.errors[e][i])o.push(l.call(a,t,u));o=o.join(", ");var c={value:t.value,label:t.ruleSet.label||t.fieldName};Object.assign(c,t.ruleSet[t.ruleName]);var h=o.charAt(0)===f.noLabelChar,p=t.rules[t.fieldName][t.ruleName].fullMessage||a.options.fullMessages;p&&!h&&(o="%{label} "+o),h&&(o=o.substr(1)),o=n(o,c);var m=t.rules[t.fieldName][t.ruleName].capitalize||a.options.capitalize;m&&(o=s(o)),a.errors[t.fieldName]=o}function c(e,t,n,s){for(var a=this,l=0;l<f.checkersSteps.length;l++){var c=f.checkersSteps[l];for(var p in s[t]){var m=S[c][p];if("undefined"!=typeof m){if(s[t][p]===!1){h("Rule definition for '"+p+"' set to 'false', are you shure?",s[t]);break}var g={value:e,fieldName:t,data:n,ruleName:p,ruleSet:s[t],rules:s,step:c};"function"!=typeof m.preprocess||m.preprocess.call(a,e,g)?i.call(a,m,e,g):o.call(a,g,g.fieldName,g.ruleName,"preprocess"),r(a.errors,t)&&u.call(a,t,e,g)}}if("undefined"!=typeof a.errors[t])break}}var f={env:"production",silent:!1,checkersSteps:["before","during"],confirmationRE:/(.+)_confirmation$/,emailRE:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,emptyStringRE:/^[\s\t\n\r]+$/,emptyValues:[null,void 0,"undefined"],messages:{confirms:"should be sames as %{field}",required:"is required",email:"is not a valid email",format:"",length:function(e){var r=e.ruleSet.length;return r.is?"must be exactly %{is} characters long":r.min&&r.max?"must be between %{min} and %{max} characters long":r.min?"must be minimum %{min} characters long":r.max?"must be maximum %{min} characters long":void 0},numeric:{onlyInteger:"must be an integer",noStrings:"strings are not allowed",equalTo:"must be equal to %{equalTo}",notEqualTo:"must not be equal to %{notEqualTo}",greaterThan:"must be greater than %{greaterThan}",greaterThanOrEqualTo:"must be greater than or equal to %{greaterThanOrEqualTo}",lessThan:"must be less than %{lessThan}",lessThanOrEqualTo:"must be less than or equal to %{lessThanOrEqualTo}"},notValid:"is not valid."},noLabelChar:"^"},h=e;if("production"!==f.env){var p="undefined"!=typeof console;h=function(e,r){p&&!f.silent&&(r?console.error("[Isntit warn]: "+e,r):console.error("[Isntit warn]: "+e))}}var m={validate:function(e,r){var t=r.data,n=r.ruleSet.confirms;return n.otherValue=t[n.field],n.strict?e===n.otherValue:e==n.otherValue},types:["boolean",{field:"string"}]},g={validate:function(e){return!a.isEmpty(e)},types:"boolean"},d={validate:function(e){return f.emailRE.test(e)},preprocess:function(e){var r=this;return"string"==typeof e||(r.cache.messages["email::preprocess"]="Values checked for email MUST be of type string. Given: "+e,!1)},types:"boolean"},v={validate:function(e,r){var t=r.ruleSet,n=t.format instanceof RegExp?t.format:t.format.pattern;return n.test(e)},preprocess:function(e){var r=this;return"string"==typeof e||"number"==typeof e||(r.cache.messages["format::preprocess"]="Values checked for format MUST either be of type string or number. Given: "+e,!1)},types:["regexp",{pattern:"regexp"}]},y={validate:{is:function(e,r){return e.length==r.ruleSet.length.is},min:function(e,r){return e.length>=r.ruleSet.length.min},max:function(e,r){return e.length<=r.ruleSet.length.max}},preprocess:function(e){var r=this;return void 0!==e.length||(r.cache.messages["length::preprocess"]="Values checked for length MUST have a length property. Given: "+e,!1)},types:{__all:"number"}},b={validate:{equalTo:function(e,r){return+e==r.ruleSet.numeric.equalTo},notEqualTo:function(e,r){return+e!=r.ruleSet.numeric.notEqualTo},greaterThan:function(e,r){return+e>r.ruleSet.numeric.greaterThan},greaterThanOrEqualTo:function(e,r){return+e>=r.ruleSet.numeric.greaterThanOrEqualTo},lessThan:function(e,r){return+e<r.ruleSet.numeric.lessThan},lessThanOrEqualTo:function(e,r){return+e<=r.ruleSet.numeric.lessThanOrEqualTo},noStrings:function(e){return"string"!=typeof e},onlyInteger:function(e){return+e%1===0}},preprocess:function(e){var r=this;return"string"==typeof e||"number"==typeof e||(r.cache.messages["numeric::preprocess"]="Values checked for numeric MUST either be of type string or number. Given: "+e,!1)},types:{noStrings:"boolean",onlyInteger:"boolean",__others:"number"}};a.prototype.options={capitalize:!0,devtools:"production"!==f.env,fullMessages:!1};var S={before:{confirms:m,required:g},during:{email:d,format:v,length:y,numeric:b}};return a.getCheckers=function(){return S},a.registerChecker=function(e,t,n,s){var a=this;if("function"==typeof e||r(e,"validate")){if(n=n||"during","undefined"==typeof t)throw new Error("When registering a callback as checker, you must provide a name for it: registerChecker(callable, name[, step[, checkersSteps]])");r(S,n)||(S[n]={},"undefined"==typeof s&&f.checkersSteps.push(n)),r(e,"validate")?S[n][t]=e:S[n][t]={validate:e}}else{arguments.length>3&&h("Instance methode registerChecker() signature is:\n(object[, step[, checkersSteps]]), supplemental arguments will be ignored.",Array.from(arguments));for(var o in e)if(s=n,f.checkersSteps.indexOf(o)!==-1){n=o;for(t in e[n])a.registerChecker(e[n][t],t,n,s)}else n=t,a.registerChecker(e[o],o,n,s)}},a.isEmpty=function(e){var r=typeof e;if(("string"===r||"array"===r)&&0===e.length)return!0;if("string"===r&&f.emptyStringRE.test(e))return!0;if(t(e)&&0===Object.keys(e).length)return!0;for(var n=0;n<f.emptyValues.length;n++)if(e===f.emptyValues[n])return!0;return!1},a.printf=n,a.ucfirst=s,a.prototype.validate=function(e,t){var n=this;t?n.checkRules(t):t=n.rules,n.errors={};for(var s in e)if(r(e,s)){if(t[s]===!0){var o=s.match(f.confirmationRE);o&&(t[s]={confirms:{field:o[1]}})}var i=e[s];c.call(n,i,s,e,t)}return!!a.isEmpty(n.errors)||n.errors},a.prototype.getCheckers=function(){return S},a.prototype.getMessages=function(){return this.errors},a.prototype.getStep=function(e){var r=this;if(!r.cache.checkersToStep[e]){for(var t=0;t<f.checkersSteps.length;t++)if(S[f.checkersSteps[t]][e]){r.cache.checkersToStep[e]=f.checkersSteps[t];break}if(!r.cache.checkersToStep[e])return h('No step found for "'+e+'". Given: '+JSON.stringify(S)),!1}return r.cache.checkersToStep[e]},a.version="1.0.0",a.prototype.checkRules=e,a});